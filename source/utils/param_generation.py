import json
from tqdm import tqdm
from glob import glob
from source import troll_to_modelica as troll

runs = {
"flat_runs" : [4303, 4305, 4318, 4319, 4320, 4329, 4328, 4325, 4330, 4332, 4334, 4333, 4337, 4338, 4340, 4341, 4343, 4342, 4345, 4348, 4346, 4350,
                4349, 4351, 4354, 4353, 4352, 4355, 4356, 4357, 4359, 4360, 4366, 4361, 4362, 4365, 4367, 4368, 4369, 4370, 4373, 4372, 4371, 4375,
                4376, 4558, 4538, 4540, 4542, 4544, 4546, 4548, 4552] , 
"bump_runs" : [4536,4558,4538,4540,4542,4544,4546,4548,4550,4552,4554,4556]
}

analyazable_starttime = {1.041666667: [4303,4305,4318,4319,4320,4322,4321,4323,4329,4328,4325],
                        1.25: [4330,4331,4332,4334,4335,4333,4336,4337,4338,4340,4341,4339],
                        1.5625: [4343,4342,4345,4347,4348,4346,4350,4349,4351,4354,4353,4352],
                        2.083333333: [4355,4356,4357,4359,4360,4366,4361,4363,4362,4364,4365],
                        3.125: [4367,4368,4369,4370,4374,4373,4372,4371,4375,4376,4377,4378],
                        6.25: [4379,4380,4381,4382,4383,4384,4385,4386,4390,4389,4388,4387], 
                        4: [4536,4538,4540,4542,4544],
                        2.5: [4554,4552,4556,4558],
                        3: [4550,4548,4546]}


troll_runs = [4303, 4305, 4318, 4319, 4320, 4329, 4328, 4325, 4330, 4332, 4334, 4333, 4337, 4338, 4340, 4341, 4343, 4342, 4345, 4348, 4346, 4350,
                    4349, 4351, 4354, 4353, 4352, 4355, 4356, 4357, 4359, 4360, 4366, 4361, 4362, 4365, 4367, 4368, 4369, 4370, 4373, 4372, 4371, 4375,
                    4376, 4558, 4538, 4540, 4542, 4544, 4546, 4548, 4552, 4536,4558,4538,4540,4542,4544,4546,4548,4550,4552,4554,4556]

if __name__ == '__main__':
    # all runs, including defect
    #[4303,4305,4318,4319,4320,4322,4321,4323,4329,4328,4325,4330,4331,4332,4334,4335,4333,4336,4337,4338,4340,4341,4339,4343,4342,4345, 4347,4348,4346,4350,4349,4351,4354,4353,4352,4355,4356,4357,4359,4360,4366,4361,4363,4362,4364,4365,4367,4368,4369,4370,4374,4373, 4372,4371,4375,4376,4377,4378,4379,4380,4381,4382,4383,4384,4385,4386,4390,4389,4388,4387]

    with open('runs_id.json', 'w', encoding='utf-8') as f:
        json.dump(runs, f, ensure_ascii=False, indent=4)

    with open('analyazable_starttime.json', 'w', encoding='utf-8') as f:
        json.dump(analyazable_starttime, f, ensure_ascii=False, indent=4)

    troll_runs_stop_time = {}
    for troll_id in tqdm(troll_runs):
        troll_run_name = glob("H:/NOT_SAVED_TO_BACKUP/TROLL_data/vlad/"+"*"+str(troll_id)+"*")[0]
        troll_run = troll.load_troll_data(troll_run_name, mode="analysis") 
        if (len(glob("C:/Users/fedi_vl/Documents/work/modelica_compatible/"+"*"+str(troll_id)+"*")[0]) > 0) and (troll_run is not None):
            troll_runs_stop_time[troll_id] = troll_run['time'][-1]

    with open('parameters/runs_stop_time.json', 'w', encoding='utf-8') as f:
        json.dump(troll_runs_stop_time, f, ensure_ascii=False, indent=4)