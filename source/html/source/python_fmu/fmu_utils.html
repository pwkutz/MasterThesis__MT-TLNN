<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>source.python_fmu.fmu_utils API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>source.python_fmu.fmu_utils</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from fmpy import read_model_description, extract, instantiate_fmu
from fmpy.fmi2 import FMU2Slave
from fmpy.util import plot_result, download_file, download_test_file
from fmpy.fmi1 import fmi1OK

from tqdm import tqdm
import numpy as np
import h5py
import glob

# for FMU errors
def log_message(componentEnvironment, instanceName, status, category, message):
    if status == fmi1OK:
        pass  # do nothing
    else:
        print(message.decode(&#39;utf-8&#39;))

def intialize_terra_fmu(fmu_filename = &#39;D://Vlad/work/ContactDynamics_ContactModels_TerRA_TerRATwoFrame_0FMU.fmu&#39;, output_feature = &#39;y[1]&#39;): 
    # options: &#39;D://Vlad/work/scm_fmu_flat.fmu&#39;

    # optimized for the timestep 1e-3
    model_description = read_model_description(fmu_filename)
    vrs = {}
    for variable in model_description.modelVariables:
        vrs[variable.name] = variable.valueReference
    vr_inputs = [vrs[x] for x in vrs.keys() if &#34;u[&#34;==x[0:2]] # standard inputs, same for the SCM and TerRA FMUs 
    vr_outputs = [vrs[output_feature]] # traction force
    unzipdir = extract(fmu_filename)
    fmu = FMU2Slave(guid=model_description.guid,
                unzipDirectory=unzipdir,
                modelIdentifier=model_description.coSimulation.modelIdentifier,
                instanceName=&#39;instance1&#39;)
    fmu.instantiate(loggingOn=False)
    fmu.setupExperiment(startTime=0)
    fmu.enterInitializationMode()
    fmu.exitInitializationMode()
    return fmu, vr_inputs, vr_outputs

def call_fmu(input_vec, fmu, vr_inputs, vr_outputs):
    f_x = []
    #print(input_vec.shape[0], input_vec.shape[1])
    for i in range(input_vec.shape[0]):
        value_inputs = input_vec[i]
        fmu.setReal(vr_inputs, value_inputs)
        fmu.doStep(currentCommunicationPoint=i*0.001, communicationStepSize=0.001)
        f_x.append(fmu.getReal(vr_outputs))
    return np.array(f_x)

def fmu_close(fmu):
    fmu.terminate()
    fmu.freeInstance()

def lf_fmu(x, intialize_fmu = intialize_terra_fmu):
    ## transfer somehow the inner state of the terra
    fmu, vr_inputs, vr_outputs = intialize_fmu()
    # determune which index &#34;x&#34; has 
    # Can I always just upload additionally all previous steps of the current input x? 
    #indx = np.argwhere(X_train, x)
    output = []
    if sum(np.all(train_scm == x[0], axis=1)) &gt; 0:
        index = np.where(np.all(train_scm == x[0], axis=1))[0][0]
        for element in x:
            output.append(call_fmu(np.vstack((train_scm[:index], element)), fmu, vr_inputs, vr_outputs)[-1])
    else:
        index = np.where(np.all(train_scm_test == x[0], axis=1))[0][0]
        for element in x:
            output.append(call_fmu(np.vstack((train_scm_test[:index], element)), fmu, vr_inputs, vr_outputs)[-1])
    return output # or X_train[:i]

def lf_fmu_grad(x, intialize_fmu = intialize_terra_fmu):
    print(&#34;i`m in lf grad&#34;)
    fmu, vr_inputs, vr_outputs = intialize_fmu()
    delta = 1e-5
    f_x_plus = []
    f_x_minus = []

    if sum(np.all(train_scm == x[0], axis=1)) &gt; 0:
        index = np.where(np.all(train_scm == x[0], axis=1))[0][0]
        for element in x:
            if index == 0:
                with_last_X_changed_plus = np.array([train_scm[index, :] + delta]) 
                with_last_X_changed_minus = np.array([train_scm[index, :] - delta]) 
            else:
                with_last_X_changed_plus = np.vstack((train_scm[:index], element + delta)) 
                with_last_X_changed_minus = np.vstack((train_scm[:index], element - delta)) 
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_plus = call_fmu(with_last_X_changed_plus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_minus = call_fmu(with_last_X_changed_minus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            fmu_close(fmu)
            ############# FIND HOW TO RESET FMU W\O FULL INITIALIZATION AND CLOSE #########################
            f_x_plus.append(changed_last_fmu_out_plus)
            f_x_minus.append(changed_last_fmu_out_minus)
        f_x_plus = np.array(f_x_plus)
        f_x_minus = np.array(f_x_minus)
        grad_x = abs(f_x_plus - f_x_minus)/(2*delta)
        
    else:
        index = np.where(np.all(train_scm_test == x[0], axis=1))[0][0]
        for element in x:
            if index == 0:
                with_last_X_changed_plus = np.array([train_scm_test[index, :] + delta]) 
                with_last_X_changed_minus = np.array([train_scm_test[index, :] - delta]) 
            else:
                with_last_X_changed_plus = np.vstack((train_scm_test[:index], x + delta)) 
                with_last_X_changed_minus = np.vstack((train_scm_test[:index], x - delta)) 
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_plus = call_fmu(with_last_X_changed_plus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_minus = call_fmu(with_last_X_changed_minus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            fmu_close(fmu)
            ############# FIND HOW TO RESET FMU W\O FULL INITIALIZATION AND CLOSE #########################
            f_x_plus.append(changed_last_fmu_out_plus)
            f_x_minus.append(changed_last_fmu_out_minus)
        f_x_plus = np.array(f_x_plus)
        f_x_minus = np.array(f_x_minus)
        grad_x = abs(f_x_plus - f_x_minus)/(2*delta)  

    return grad_x #output

#Adjusting HDF5 file with auxiliary variables for the SCM FMU
def adjust_scm_data_for_fmu():
    filename = &#34;D:/Vlad/work/scm_from_troll.h5&#34;
    data = h5py.File(filename, &#39;a&#39;)
    out_ = np.array(data[&#34;aux&#34;])
    tmp = []
    for i in tqdm(range(len(out_))):
        tmp.append(np.concatenate((np.array(out_[i][0])[np.newaxis], out_[i][1])))
    data.create_dataset(&#39;/aux_mod&#39;, data=np.array(tmp))
    data.close()
    import scipy.io
    name = &#39;scm_output.mat&#39;
    scipy.io.savemat(name, mdict={&#39;aux&#39;: np.array(tmp)})

if __name__ == &#34;__main__&#34;:


    vrs = {}
    for variable in model_description.modelVariables:
        vrs[variable.name] = variable.valueReference

    vr_inputs = [vrs[x] for x in vrs.keys() if &#34;u[&#34;==x[0:2]] # standard inputs
    #vr_inputs.append(vrs[&#39;elevationMap.surface.RunID&#39;])

    vr_outputs = [vrs[&#39;wheel_inside_fmu.datagathering.output_values[1]&#39;]] # traction force
    unzipdir = extract(fmu_filename)
    fmu = FMU2Slave(guid=model_description.guid,
                unzipDirectory=unzipdir,
                modelIdentifier=model_description.coSimulation.modelIdentifier,
                instanceName=&#39;instance1&#39;)
    fmu.instantiate(loggingOn=False)
    fmu.setupExperiment(startTime=0)
    fmu.enterInitializationMode()
    fmu.exitInitializationMode()

    scm_ids = np.array([])
    for troll_id in tqdm(train): 
        # load troll data (hifi)
        troll_run_name = glob(&#34;H:/NOT_SAVED_TO_BACKUP/TROLL_data/vlad/&#34;+&#34;*&#34;+str(troll_id)+&#34;*&#34;)[0]
        troll_run = troll.load_troll_data(troll_run_name, mode=&#34;analysis&#34;)
        troll_dataset = troll.transform_run(troll_run)
        # filter out robotic arm acceleration
        a_tcp_rotated = arm_acceleration(troll_run)
        # compensate troll forces with the robotic arm acceleration
        troll_force_current = troll_dataset[:, 14] + 20.97*a_tcp_rotated[:, 0] # traction force
        troll_X_current = troll_dataset[:, 1:14]
        runtime = troll_dataset[-1, 0] # how long was the run?
        start_time = [x for x in analyazable_starttime if troll_id in analyazable_starttime[x]][0]
        scm_ids = np.concatenate((scm_ids, np.repeat(troll_id, round(runtime-start_time)*1-2)))

    train = scm_X[:, 12:]

    #f_x = []
    #print(input_vec.shape[0], input_vec.shape[1])
    for i in tqdm(range(train.shape[0])):
        value_inputs = np.concatenate((train[i], np.array([scm_ids[i]])))
        fmu.setReal(vr_inputs, value_inputs)
        fmu.doStep(currentCommunicationPoint=i*0.001, communicationStepSize=0.001)
        #f_x.append(fmu.getReal(vr_outputs))

        #READ FROM OUT.h5 TRACTION FORCE

    ################## COMPARE SCM MODELICA OUTPUT AND SCM-FMU
    filename = &#34;C:/Users/fedi_vl/Documents/work/all_runs_from_troll.h5&#34;
    data = h5py.File(filename, &#39;r&#39;)
    scm = data[str(4339)][&#39;scm&#39;]
    scm_input = np.array([x[1][:12] for x in scm[&#34;input&#34;]])
    scm_fmu_input = np.array([x[1] for x in scm[&#34;aux&#34;]])
    scm_force = np.array([x[1][0] for x in scm[&#34;output&#34;]])
    f_x = []
    vr_outputs = [vrs[&#39;wheel_inside_fmu.datagathering.output_values[1]&#39;]]
    for i in tqdm(range(scm_fmu_input.shape[0])):
        value_inputs = scm_fmu_input[i]
        fmu.setReal(vr_inputs, value_inputs)
        fmu.doStep(currentCommunicationPoint=i*0.001, communicationStepSize=0.001)
        f_x.append(fmu.getReal(vr_outputs))
    
    plt.figure(figsize=(15,10))
    plt.plot(f_x, label = &#34;FMU&#34;)
    plt.plot(scm_force, label = &#34;SCM&#34;)
    plt.legend()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="source.python_fmu.fmu_utils.adjust_scm_data_for_fmu"><code class="name flex">
<span>def <span class="ident">adjust_scm_data_for_fmu</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def adjust_scm_data_for_fmu():
    filename = &#34;D:/Vlad/work/scm_from_troll.h5&#34;
    data = h5py.File(filename, &#39;a&#39;)
    out_ = np.array(data[&#34;aux&#34;])
    tmp = []
    for i in tqdm(range(len(out_))):
        tmp.append(np.concatenate((np.array(out_[i][0])[np.newaxis], out_[i][1])))
    data.create_dataset(&#39;/aux_mod&#39;, data=np.array(tmp))
    data.close()
    import scipy.io
    name = &#39;scm_output.mat&#39;
    scipy.io.savemat(name, mdict={&#39;aux&#39;: np.array(tmp)})</code></pre>
</details>
</dd>
<dt id="source.python_fmu.fmu_utils.call_fmu"><code class="name flex">
<span>def <span class="ident">call_fmu</span></span>(<span>input_vec, fmu, vr_inputs, vr_outputs)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def call_fmu(input_vec, fmu, vr_inputs, vr_outputs):
    f_x = []
    #print(input_vec.shape[0], input_vec.shape[1])
    for i in range(input_vec.shape[0]):
        value_inputs = input_vec[i]
        fmu.setReal(vr_inputs, value_inputs)
        fmu.doStep(currentCommunicationPoint=i*0.001, communicationStepSize=0.001)
        f_x.append(fmu.getReal(vr_outputs))
    return np.array(f_x)</code></pre>
</details>
</dd>
<dt id="source.python_fmu.fmu_utils.fmu_close"><code class="name flex">
<span>def <span class="ident">fmu_close</span></span>(<span>fmu)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fmu_close(fmu):
    fmu.terminate()
    fmu.freeInstance()</code></pre>
</details>
</dd>
<dt id="source.python_fmu.fmu_utils.intialize_terra_fmu"><code class="name flex">
<span>def <span class="ident">intialize_terra_fmu</span></span>(<span>fmu_filename='D://Vlad/work/ContactDynamics_ContactModels_TerRA_TerRATwoFrame_0FMU.fmu', output_feature='y[1]')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def intialize_terra_fmu(fmu_filename = &#39;D://Vlad/work/ContactDynamics_ContactModels_TerRA_TerRATwoFrame_0FMU.fmu&#39;, output_feature = &#39;y[1]&#39;): 
    # options: &#39;D://Vlad/work/scm_fmu_flat.fmu&#39;

    # optimized for the timestep 1e-3
    model_description = read_model_description(fmu_filename)
    vrs = {}
    for variable in model_description.modelVariables:
        vrs[variable.name] = variable.valueReference
    vr_inputs = [vrs[x] for x in vrs.keys() if &#34;u[&#34;==x[0:2]] # standard inputs, same for the SCM and TerRA FMUs 
    vr_outputs = [vrs[output_feature]] # traction force
    unzipdir = extract(fmu_filename)
    fmu = FMU2Slave(guid=model_description.guid,
                unzipDirectory=unzipdir,
                modelIdentifier=model_description.coSimulation.modelIdentifier,
                instanceName=&#39;instance1&#39;)
    fmu.instantiate(loggingOn=False)
    fmu.setupExperiment(startTime=0)
    fmu.enterInitializationMode()
    fmu.exitInitializationMode()
    return fmu, vr_inputs, vr_outputs</code></pre>
</details>
</dd>
<dt id="source.python_fmu.fmu_utils.lf_fmu"><code class="name flex">
<span>def <span class="ident">lf_fmu</span></span>(<span>x, intialize_fmu=&lt;function intialize_terra_fmu&gt;)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def lf_fmu(x, intialize_fmu = intialize_terra_fmu):
    ## transfer somehow the inner state of the terra
    fmu, vr_inputs, vr_outputs = intialize_fmu()
    # determune which index &#34;x&#34; has 
    # Can I always just upload additionally all previous steps of the current input x? 
    #indx = np.argwhere(X_train, x)
    output = []
    if sum(np.all(train_scm == x[0], axis=1)) &gt; 0:
        index = np.where(np.all(train_scm == x[0], axis=1))[0][0]
        for element in x:
            output.append(call_fmu(np.vstack((train_scm[:index], element)), fmu, vr_inputs, vr_outputs)[-1])
    else:
        index = np.where(np.all(train_scm_test == x[0], axis=1))[0][0]
        for element in x:
            output.append(call_fmu(np.vstack((train_scm_test[:index], element)), fmu, vr_inputs, vr_outputs)[-1])
    return output # or X_train[:i]</code></pre>
</details>
</dd>
<dt id="source.python_fmu.fmu_utils.lf_fmu_grad"><code class="name flex">
<span>def <span class="ident">lf_fmu_grad</span></span>(<span>x, intialize_fmu=&lt;function intialize_terra_fmu&gt;)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def lf_fmu_grad(x, intialize_fmu = intialize_terra_fmu):
    print(&#34;i`m in lf grad&#34;)
    fmu, vr_inputs, vr_outputs = intialize_fmu()
    delta = 1e-5
    f_x_plus = []
    f_x_minus = []

    if sum(np.all(train_scm == x[0], axis=1)) &gt; 0:
        index = np.where(np.all(train_scm == x[0], axis=1))[0][0]
        for element in x:
            if index == 0:
                with_last_X_changed_plus = np.array([train_scm[index, :] + delta]) 
                with_last_X_changed_minus = np.array([train_scm[index, :] - delta]) 
            else:
                with_last_X_changed_plus = np.vstack((train_scm[:index], element + delta)) 
                with_last_X_changed_minus = np.vstack((train_scm[:index], element - delta)) 
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_plus = call_fmu(with_last_X_changed_plus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_minus = call_fmu(with_last_X_changed_minus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            fmu_close(fmu)
            ############# FIND HOW TO RESET FMU W\O FULL INITIALIZATION AND CLOSE #########################
            f_x_plus.append(changed_last_fmu_out_plus)
            f_x_minus.append(changed_last_fmu_out_minus)
        f_x_plus = np.array(f_x_plus)
        f_x_minus = np.array(f_x_minus)
        grad_x = abs(f_x_plus - f_x_minus)/(2*delta)
        
    else:
        index = np.where(np.all(train_scm_test == x[0], axis=1))[0][0]
        for element in x:
            if index == 0:
                with_last_X_changed_plus = np.array([train_scm_test[index, :] + delta]) 
                with_last_X_changed_minus = np.array([train_scm_test[index, :] - delta]) 
            else:
                with_last_X_changed_plus = np.vstack((train_scm_test[:index], x + delta)) 
                with_last_X_changed_minus = np.vstack((train_scm_test[:index], x - delta)) 
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_plus = call_fmu(with_last_X_changed_plus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            changed_last_fmu_out_minus = call_fmu(with_last_X_changed_minus, fmu, vr_inputs, vr_outputs)[-1]
            fmu_close(fmu)
            fmu, vr_inputs, vr_outputs = intialize_fmu()
            fmu_close(fmu)
            ############# FIND HOW TO RESET FMU W\O FULL INITIALIZATION AND CLOSE #########################
            f_x_plus.append(changed_last_fmu_out_plus)
            f_x_minus.append(changed_last_fmu_out_minus)
        f_x_plus = np.array(f_x_plus)
        f_x_minus = np.array(f_x_minus)
        grad_x = abs(f_x_plus - f_x_minus)/(2*delta)  

    return grad_x #output</code></pre>
</details>
</dd>
<dt id="source.python_fmu.fmu_utils.log_message"><code class="name flex">
<span>def <span class="ident">log_message</span></span>(<span>componentEnvironment, instanceName, status, category, message)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def log_message(componentEnvironment, instanceName, status, category, message):
    if status == fmi1OK:
        pass  # do nothing
    else:
        print(message.decode(&#39;utf-8&#39;))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="source.python_fmu" href="index.html">source.python_fmu</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="source.python_fmu.fmu_utils.adjust_scm_data_for_fmu" href="#source.python_fmu.fmu_utils.adjust_scm_data_for_fmu">adjust_scm_data_for_fmu</a></code></li>
<li><code><a title="source.python_fmu.fmu_utils.call_fmu" href="#source.python_fmu.fmu_utils.call_fmu">call_fmu</a></code></li>
<li><code><a title="source.python_fmu.fmu_utils.fmu_close" href="#source.python_fmu.fmu_utils.fmu_close">fmu_close</a></code></li>
<li><code><a title="source.python_fmu.fmu_utils.intialize_terra_fmu" href="#source.python_fmu.fmu_utils.intialize_terra_fmu">intialize_terra_fmu</a></code></li>
<li><code><a title="source.python_fmu.fmu_utils.lf_fmu" href="#source.python_fmu.fmu_utils.lf_fmu">lf_fmu</a></code></li>
<li><code><a title="source.python_fmu.fmu_utils.lf_fmu_grad" href="#source.python_fmu.fmu_utils.lf_fmu_grad">lf_fmu_grad</a></code></li>
<li><code><a title="source.python_fmu.fmu_utils.log_message" href="#source.python_fmu.fmu_utils.log_message">log_message</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>